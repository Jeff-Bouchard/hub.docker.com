<!DOCTYPE html>
<html lang="en" data-ness-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>NESS Core Node Dashboard</title>
  <style>
    :root {
      --bg-primary: #020409;
      --bg-panel: #080b13;
      --bg-panel-alt: #0d111a;
      --bg-chip: rgba(255, 255, 255, 0.05);
      --border-color: #232838;
      --text-main: #f5f8ff;
      --text-muted: #9aa5c5;
      --accent: #f78f1e;
      --accent-2: #4fc1ff;
      --accent-3: #ce60ff;
      --danger: #ff5470;
      --success: #5ce0a0;
      --shadow: 0 18px 40px rgba(0, 0, 0, 0.45);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.5;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top, #101326, var(--bg-primary));
      color: var(--text-main);
      padding: 24px clamp(16px, 4vw, 52px) 40px;
    }

    h1, h2, h3, h4 {
      margin: 0;
      font-weight: 600;
    }

    a {
      color: var(--accent-2);
    }

    .app-shell {
      max-width: 1320px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .hero {
      background: linear-gradient(135deg, rgba(11, 14, 25, 0.95), rgba(5, 7, 14, 0.9));
      border: 1px solid var(--border-color);
      border-radius: 18px;
      padding: 22px 22px 18px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .hero-top {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
    }

    .hero-title {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .hero-title h1 {
      font-size: 1.4rem;
    }

    .hero-title span {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .badge {
      border-radius: 999px;
      padding: 5px 14px;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--bg-chip);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--text-muted);
    }

    .badge strong {
      color: var(--accent-2);
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .card {
      background: var(--bg-panel);
      border: 1px solid var(--border-color);
      border-radius: 18px;
      padding: 18px 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .card-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 10px;
    }

    .card-header h2,
    .card-header h3 {
      font-size: 1rem;
      color: var(--accent-2);
    }

    .card-header small {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .wallet-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 14px;
    }

    label span {
      display: block;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    input[type="file"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: var(--bg-panel-alt);
      color: var(--text-main);
      font-size: 0.9rem;
    }

    .file-info {
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--text-muted);
      white-space: pre-wrap;
      word-break: break-all;
    }

    .services-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 16px;
    }

    .service-card h3 {
      font-size: 1rem;
      color: var(--accent-2);
    }

    .service-meta {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .status-row {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #555a71;
      flex-shrink: 0;
    }

    .status-ok {
      background: var(--success);
    }

    .status-fail {
      background: var(--danger);
    }

    .status-unknown {
      background: #555a71;
    }

    .buttons-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 6px;
    }

    button {
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 0.9rem;
      border-radius: 999px;
      padding: 7px 14px;
      color: #04050a;
      background: linear-gradient(135deg, var(--accent), #ffbf5a);
      transition: transform 100ms ease, box-shadow 100ms ease, opacity 80ms ease;
    }

    button.small {
      font-size: 0.8rem;
      padding: 6px 11px;
    }

    button.secondary {
      background: linear-gradient(135deg, var(--accent-2), #7fe1ff);
      color: #010409;
    }

    button.danger {
      background: linear-gradient(135deg, var(--danger), #ff7f97);
      color: #02030b;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 7px 14px rgba(0, 0, 0, 0.38);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .log-pane {
      background: var(--bg-panel-alt);
      border-radius: 14px;
      border: 1px solid var(--border-color);
      padding: 10px 12px;
      max-height: 320px;
      overflow: auto;
      font-family: "JetBrains Mono", "Fira Code", Consolas, monospace;
      font-size: 0.78rem;
      white-space: pre-wrap;
    }

    .log-line {
      margin: 0;
    }

    .log-info {
      color: var(--text-muted);
    }

    .log-success {
      color: var(--success);
    }

    .log-error {
      color: var(--danger);
    }

    .log-divider {
      color: #4a5066;
    }

    @media (max-width: 640px) {
      .hero-top {
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <section class="hero">
      <div class="hero-top">
        <div class="hero-title">
          <h1>NESS Core Node Dashboard</h1>
          <span>Quick entry points to local services + wallet file helpers (all client-side).</span>
        </div>
        <div class="badge-row">
          <div class="badge"><strong>CORE</strong><span>Emercoin · NESS · DNS · Entropy</span></div>
          <div class="badge"><strong>OVERLAYS</strong><span>Yggdrasil · I2P · Skywire · AmneziaWG</span></div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2>Wallet files (local only)</h2>
        <small>EMC wallet.dat &amp; NESS wallet – inspected in your browser, never uploaded.</small>
      </div>
      <div class="wallet-grid">
        <div>
          <label>
            <span>Emercoin wallet.dat</span>
            <input type="file" id="emcWallet" accept=".dat,application/octet-stream" />
          </label>
          <div id="emcWalletInfo" class="file-info">No file selected.</div>
        </div>
        <div>
          <label>
            <span>NESS wallet file</span>
            <input type="file" id="nessWallet" />
          </label>
          <div id="nessWalletInfo" class="file-info">No file selected.</div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2>Local services</h2>
        <small>Helpers for the ports exposed by docker-compose on 127.0.0.1.</small>
      </div>
      <div class="services-grid">
        <!-- Privateness / NESS -->
        <article class="card service-card">
          <div class="card-header">
            <h3>Privateness / NESS</h3>
            <small>Local GUI / RPC endpoint</small>
          </div>
          <div class="status-row">
            <span class="status-dot status-unknown" data-status-dot="privateness"></span>
            <span class="status-text" data-status-text="privateness">Unknown</span>
          </div>
          <p class="service-meta">Open the NESS wallet GUI or query basic RPC status via the local node.</p>
          <div class="buttons-row">
            <button class="small" type="button" id="btnOpenNessGui">Open NESS GUI</button>
            <button class="small secondary" type="button" id="btnPrivStatus">RPC status</button>
          </div>
        </article>

        <!-- pyuheprng -->
        <article class="card service-card">
          <div class="card-header">
            <h3>pyuheprng entropy</h3>
            <small>Local HTTP service</small>
          </div>
          <div class="status-row">
            <span class="status-dot status-unknown" data-status-dot="pyuheprng"></span>
            <span class="status-text" data-status-text="pyuheprng">Unknown</span>
          </div>
          <p class="service-meta">Call the built-in health and entropy rate endpoints.</p>
          <div class="buttons-row">
            <button class="small" type="button" id="btnPyuHealth">GET /health</button>
            <button class="small" type="button" id="btnPyuSources">GET /sources</button>
            <button class="small" type="button" id="btnPyuRate">GET /rate</button>
          </div>
        </article>

        <!-- privatenesstools -->
        <article class="card service-card">
          <div class="card-header">
            <h3>privatenesstools</h3>
            <small>Local HTTP tools service</small>
          </div>
          <div class="status-row">
            <span class="status-dot status-unknown" data-status-dot="privatenesstools"></span>
            <span class="status-text" data-status-text="privatenesstools">Unknown</span>
          </div>
          <p class="service-meta">Check the tools service health endpoint.</p>
          <div class="buttons-row">
            <button class="small" type="button" id="btnPntHealth">GET /health</button>
          </div>
        </article>

        <!-- dns-reverse-proxy -->
        <article class="card service-card">
          <div class="card-header">
            <h3>DNS reverse proxy</h3>
            <small>Local DNS proxy / control</small>
          </div>
          <div class="status-row">
            <span class="status-dot status-unknown" data-status-dot="dns"></span>
            <span class="status-text" data-status-text="dns">Unknown</span>
          </div>
          <p class="service-meta">Test whether the HTTP control/metrics port on 8053 responds.</p>
          <div class="buttons-row">
            <button class="small" type="button" id="btnDnsControl">Probe HTTP on 8053</button>
          </div>
        </article>

        <!-- Skywire visor -->
        <article class="card service-card">
          <div class="card-header">
            <h3>Skywire visor</h3>
            <small>Visor dashboard</small>
          </div>
          <div class="status-row">
            <span class="status-dot status-unknown" data-status-dot="skywire"></span>
            <span class="status-text" data-status-text="skywire">Unknown</span>
          </div>
          <p class="service-meta">Open the Skywire visor dashboard (plain visor container).</p>
          <div class="buttons-row">
            <button class="small" type="button" id="btnSkywireUi">Open visor UI</button>
          </div>
        </article>

        <!-- Skywire over AmneziaWG -->
        <article class="card service-card">
          <div class="card-header">
            <h3>Skywire over AmneziaWG</h3>
            <small>Visor bound to AmneziaWG tunnel</small>
          </div>
          <div class="status-row">
            <span class="status-dot status-unknown" data-status-dot="skywire-amn"></span>
            <span class="status-text" data-status-text="skywire-amn">Unknown</span>
          </div>
          <p class="service-meta">Open the Skywire visor that is bound to the AmneziaWG tunnel.</p>
          <div class="buttons-row">
            <button class="small" type="button" id="btnSkyAmnUi">Open visor UI</button>
          </div>
        </article>

        <!-- I2P-Yggdrasil console -->
        <article class="card service-card">
          <div class="card-header">
            <h3>I2P console (over Yggdrasil)</h3>
            <small>I2P web console</small>
          </div>
          <div class="status-row">
            <span class="status-dot status-unknown" data-status-dot="i2p"></span>
            <span class="status-text" data-status-text="i2p">Unknown</span>
          </div>
          <p class="service-meta">Open the i2pd web console exposed by the i2p-yggdrasil container.</p>
          <div class="buttons-row">
            <button class="small" type="button" id="btnI2pConsole">Open I2P console</button>
          </div>
        </article>

        <!-- Emercoin RPC note -->
        <article class="card service-card">
          <div class="card-header">
            <h3>Emercoin core (note)</h3>
            <small>RPC: 6662 (cookie auth)</small>
          </div>
          <p class="service-meta">
            Emercoin JSON-RPC on 6662 uses a cookie for auth inside the container, which browsers cannot access safely.
            For local control, prefer the <code>./emercoin-cli</code> wrapper or GraphQL at <a href="https://emerapi.info/graphql" target="_blank" rel="noreferrer">emerapi.info</a>.
          </p>
        </article>
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h2>HTTP response log</h2>
        <small>Last responses from local services.</small>
      </div>
      <div class="log-pane" id="logPane"></div>
    </section>
  </div>

  <script>
    const BASE_HOST = "hub.private.ness";
    const BASE_ORIGIN = "http://" + BASE_HOST;
    const logPane = document.getElementById("logPane");

    function log(message, level = "info") {
      const p = document.createElement("div");
      p.className = `log-line log-${level}`;
      const ts = new Date().toISOString();
      p.textContent = `[${ts}] ${message}`;
      logPane.appendChild(p);
      logPane.scrollTop = logPane.scrollHeight;
    }

    function logDivider(label) {
      const p = document.createElement("div");
      p.className = "log-line log-divider";
      p.textContent = `\n==== ${label} ====\n`;
      logPane.appendChild(p);
      logPane.scrollTop = logPane.scrollHeight;
    }

    function setStatus(id, state, message) {
      var dot = document.querySelector('[data-status-dot="' + id + '"]');
      var text = document.querySelector('[data-status-text="' + id + '"]');
      if (!dot || !text) return;
      dot.classList.remove("status-ok", "status-fail", "status-unknown");
      var cls = state === "ok" ? "status-ok" : state === "fail" ? "status-fail" : "status-unknown";
      dot.classList.add(cls);
      text.textContent = message;
    }

    function openService(label, url, statusId) {
      logDivider(label);
      log("Opening " + url + " in a new tab...", "info");
      window.open(url, "_blank", "noopener,noreferrer");
      if (statusId) {
        setStatus(statusId, "ok", "Opened");
      }
    }

    async function httpGet(label, port, path) {
      const url = BASE_ORIGIN + ":" + String(port) + path;
      logDivider(`${label} → GET ${url}`);
      try {
        const res = await fetch(url, { method: "GET" });
        const text = await res.text();
        const head = text.slice(0, 4000);
        if (!res.ok) {
          log(`HTTP ${res.status} ${res.statusText}: ${head}`, "error");
        } else {
          log(head || "(empty response)", "success");
        }
      } catch (err) {
        log(`Request failed: ${err.message}`, "error");
      }
    }

    async function privatenessStatus() {
      // Best-effort JSON-RPC call to method "status" on 6660.
      const url = BASE_ORIGIN + ":6660";
      const body = {
        jsonrpc: "2.0",
        id: "webui",
        method: "status",
        params: []
      };
      logDivider(`Privateness RPC status → POST ${url}`);
      try {
        const res = await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });
        const text = await res.text();
        let pretty = text;
        try {
          const parsed = JSON.parse(text);
          pretty = JSON.stringify(parsed, null, 2);
        } catch (_) {}
        if (!res.ok) {
          log(`HTTP ${res.status} ${res.statusText}: ${pretty}`, "error");
        } else {
          log(pretty, "success");
        }
      } catch (err) {
        log(`RPC request failed: ${err.message}`, "error");
      }
    }

    function bindWalletInput(inputId, infoId) {
      const input = document.getElementById(inputId);
      const info = document.getElementById(infoId);
      if (!input || !info) return;

      input.addEventListener("change", () => {
        const file = input.files && input.files[0];
        if (!file) {
          info.textContent = "No file selected.";
          return;
        }
        info.textContent = `${file.name} (${file.size.toLocaleString()} bytes)\nComputing SHA-256...`;

        const reader = new FileReader();
        reader.onload = async (ev) => {
          try {
            const buffer = ev.target.result;
            if (!window.crypto || !window.crypto.subtle) {
              info.textContent = `${file.name} (${file.size.toLocaleString()} bytes)\nSHA-256 not available in this browser.`;
              return;
            }
            const hash = await crypto.subtle.digest("SHA-256", buffer);
            const hex = Array.from(new Uint8Array(hash))
              .map(b => b.toString(16).padStart(2, "0"))
              .join("");
            info.textContent = `${file.name} (${file.size.toLocaleString()} bytes)\nSHA-256: ${hex}`;
          } catch (err) {
            info.textContent = `${file.name} (${file.size.toLocaleString()} bytes)\nError computing hash: ${err.message}`;
          }
        };
        reader.readAsArrayBuffer(file);
      });
    }

    // Bind wallet inputs
    bindWalletInput("emcWallet", "emcWalletInfo");
    bindWalletInput("nessWallet", "nessWalletInfo");

    // Bind service buttons
    (function bindServiceButtons() {
      var btnOpenNessGui = document.getElementById("btnOpenNessGui");
      if (btnOpenNessGui) {
        btnOpenNessGui.addEventListener("click", function () {
          openService("Open NESS GUI", BASE_ORIGIN + ":6006", "privateness");
        });
      }

      var btnPrivStatus = document.getElementById("btnPrivStatus");
      if (btnPrivStatus) {
        btnPrivStatus.addEventListener("click", function () {
          privatenessStatus();
        });
      }

      var btnPyuHealth = document.getElementById("btnPyuHealth");
      if (btnPyuHealth) {
        btnPyuHealth.addEventListener("click", function () {
          openService("pyuheprng /health", BASE_ORIGIN + ":5000/health", "pyuheprng");
        });
      }

      var btnPyuSources = document.getElementById("btnPyuSources");
      if (btnPyuSources) {
        btnPyuSources.addEventListener("click", function () {
          openService("pyuheprng /sources", BASE_ORIGIN + ":5000/sources", "pyuheprng");
        });
      }

      var btnPyuRate = document.getElementById("btnPyuRate");
      if (btnPyuRate) {
        btnPyuRate.addEventListener("click", function () {
          openService("pyuheprng /rate", BASE_ORIGIN + ":5000/rate", "pyuheprng");
        });
      }

      var btnPntHealth = document.getElementById("btnPntHealth");
      if (btnPntHealth) {
        btnPntHealth.addEventListener("click", function () {
          openService("privatenesstools /health", BASE_ORIGIN + ":8888/health", "privatenesstools");
        });
      }

      var btnDnsControl = document.getElementById("btnDnsControl");
      if (btnDnsControl) {
        btnDnsControl.addEventListener("click", function () {
          openService("dns-reverse-proxy control", BASE_ORIGIN + ":8053/", "dns");
        });
      }

      var btnSkywireUi = document.getElementById("btnSkywireUi");
      if (btnSkywireUi) {
        btnSkywireUi.addEventListener("click", function () {
          openService("Open Skywire visor", BASE_ORIGIN + ":8000", "skywire");
        });
      }

      var btnSkyAmnUi = document.getElementById("btnSkyAmnUi");
      if (btnSkyAmnUi) {
        btnSkyAmnUi.addEventListener("click", function () {
          openService("Open Skywire-AmneziaWG visor", BASE_ORIGIN + ":8002", "skywire-amn");
        });
      }

      var btnI2pConsole = document.getElementById("btnI2pConsole");
      if (btnI2pConsole) {
        btnI2pConsole.addEventListener("click", function () {
          openService("Open I2P console", BASE_ORIGIN + ":7657", "i2p");
        });
      }
    })();
  </script>
</body>
</html>
