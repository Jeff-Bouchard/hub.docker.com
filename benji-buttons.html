<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Benji Buttons</title>
  <style>
    body { background: #101c2a; color: #e0e0e0; font-family: 'Fira Sans', Arial, sans-serif; margin: 0; }
    .container { max-width: 700px; margin: 40px auto; background: #171f2e; border-radius: 12px; box-shadow: 0 0 12px #0008; padding: 2em 2.5em; text-align: center; }
    h1 { color: #6ec6ff; margin-bottom: 0.2em; }
    p.subtitle { color: #9ab6d6; margin-top: 0; margin-bottom: 2em; }
    .buttons { display: flex; flex-direction: column; gap: 1em; }
    .btn {
      display: inline-block;
      padding: 0.9em 1.4em;
      border-radius: 8px;
      border: none;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #6ec6ff, #2196f3);
      color: #101c2a;
      text-decoration: none;
      transition: transform 0.08s ease-out, box-shadow 0.08s ease-out, background 0.2s ease-in-out;
      box-shadow: 0 0 0 1px #28334a, 0 10px 25px rgba(0,0,0,0.45);
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 14px 30px rgba(0,0,0,0.55); }
    .btn:active { transform: translateY(0); box-shadow: 0 8px 20px rgba(0,0,0,0.45); background: #2196f3; }
    .btn.secondary { background: linear-gradient(135deg, #ffb74d, #ff9800); color: #101c2a; }
    .btn.tertiary { background: linear-gradient(135deg, #ab47bc, #8e24aa); color: #f8f5ff; }
    .footer { margin-top: 2em; text-align: center; color: #6ec6ff; font-size: 0.95em; }
    .result {
      margin-top: 2em;
      text-align: left;
      background: #101624;
      border-radius: 8px;
      border: 1px solid #28334a;
      padding: 1em 1.2em;
      font-family: "Fira Code", monospace;
      font-size: 0.95em;
      max-height: 260px;
      overflow: auto;
      white-space: pre-wrap;
      word-break: break-word;
    }
    @media (max-width: 800px) { .container { padding: 1.5em 1em; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>Benji Control</h1>
    <p class="subtitle">Fetch EmerNVS records via emerapi.info GraphQL: ness:wallet, ness:hub and ness:id.</p>
    <div class="buttons">
      <button id="benji-wallet" class="btn">Benji &mdash; Wallet (ness:wallet)</button>
      <button id="benji-hub" class="btn secondary">Benji &mdash; Hub (ness:hub)</button>
      <button id="benji-id" class="btn tertiary">Benji &mdash; ID (ness:id)</button>
    </div>
    <div id="benji-result" class="result" style="display:none;"></div>
    <div class="footer">Privateness.Network &copy; 2025</div>
  </div>
  <script>
    const API_URL = 'https://emerapi.info/graphql';

    function formatQuery(name) {
      const data = JSON.stringify({ name });
      // query { callwalletfunction(method:"name_show", data:"{ \"name\": \"ness:wallet\" }") { answer } }
      return `query { callwalletfunction(method: "name_show", data: ${JSON.stringify(data)}) { answer } }`;
    }

    async function fetchNvs(name) {
      const res = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query: formatQuery(name) })
      });
      const json = await res.json();
      if (json.errors) {
        throw new Error(JSON.stringify(json.errors, null, 2));
      }
      const answer = json.data && json.data.callwalletfunction && json.data.callwalletfunction.answer;
      if (!answer || !answer.result) {
        return JSON.stringify(answer, null, 2);
      }
      const result = answer.result;
      // Prefer the EmerNVS value field for copy-paste, like the curl line
      if (typeof result.value === 'string' && result.value.trim() !== '') {
        return result.value.trim();
      }
      // Fallback: show full result JSON
      return JSON.stringify(result, null, 2);
    }

    function showResult(title, text) {
      const box = document.getElementById('benji-result');
      box.style.display = '';
      box.textContent = `${title}\n\n${text}`;
    }

    function wireBenji(id, nvsName, label) {
      const btn = document.getElementById(id);
      if (!btn) return;
      btn.addEventListener('click', async () => {
        btn.disabled = true;
        const orig = btn.textContent;
        btn.textContent = `${orig} â€¦`;
        try {
          const result = await fetchNvs(nvsName);
          showResult(`${label} (${nvsName})`, result);
        } catch (e) {
          showResult(`${label} (${nvsName}) - ERROR`, String(e));
        } finally {
          btn.disabled = false;
          btn.textContent = orig;
        }
      });
    }

    wireBenji('benji-wallet', 'ness:wallet', 'EmerNVS Wallet');
    wireBenji('benji-hub', 'ness:hub', 'EmerNVS Hub');
    wireBenji('benji-id', 'ness:id', 'EmerNVS ID');
  </script>
</body>
</html>
